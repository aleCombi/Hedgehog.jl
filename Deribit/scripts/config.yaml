# ===============================
# Heston Calibration Configuration
# ===============================

# --- Data paths ---
data:
  # Root directory that contains one or more subfolders each with:
  #   data_parquet/deribit_chain/date=YYYY-MM-DD/underlying=BTC/*.parquet
  base_path: "C:/repos/DeribitVols/data/downloaded/all_20251022-192655"
  underlying: "BTC"

# --- Calibration anchor ---
calibration:
  date: "2025-10-20"      # YYYY-MM-DD
  time_filter: "12:00:00" # HH:MM:SS; used to pick the closest file that day

  # Initial parameter guesses
  initial_params:
    v0: 0.25
    kappa: 20.0
    theta: 0.24
    sigma: 5.0
    rho: -0.3

  # Parameter bounds
  lower_bounds:
    v0: 0.04
    kappa: 0.5
    theta: 0.04
    sigma: 0.1
    rho: -0.99

  upper_bounds:
    v0: 0.8
    kappa: 80.0
    theta: 0.8
    sigma: 15.0
    rho: 0.99

# --- Validation settings ---
validation:
  enabled: true

  # Option A: explicit timestamps (still supported)
  # validation_times:
  #   - "2025-10-21 13:00:00"
  #   - "2025-10-21 15:00:00"
  #   - "2025-10-21 18:00:00"

  # Option B: simple hours ahead (still supported)
  # hours_ahead: [1, 2, 3, 4, 5, 6]

  # Option C (NEW): periodic schedule
  schedule:
    # Frequency and horizon in compact form: "<int><unit>" where unit is m/h/d
    every: "5m"     # "15m", "30m", "1h", "2h", "6h", "1d", ...
    for:   "6h"     # horizon length from anchor; e.g. "2h", "12h", "1d"
    # Optional alternative anchor override; if null, uses (calibration.date + calibration.time_filter)
    start_at: null   # e.g. "2025-10-21 12:00:00"
    # Optional cap on number of steps; null means unlimited by horizon
    max_steps: null  # e.g. 48
    # How to select the file for each target time: "closest" or "floor"
    selection: "floor"

# --- Market data filtering ---
filtering:
  min_days: 14
  max_years: 2
  min_moneyness: 0.8
  max_moneyness: 1.2

# --- Market parameters ---
market:
  risk_free_rate: 0.03

# --- Pricing method settings ---
pricing:
  method: "CarrMadan"
  carr_madan:
    alpha: 1.0
    grid_size: 32.0

# --- Surface grid settings (unused by this script but kept for completeness) ---
surface_grid:
  num_strikes: 40
  num_expiries: 30
  min_price_threshold: 0.1

# --- Implied vol solver settings ---
implied_vol:
  initial_guess: 0.5
  lower_bound: 0.05
  upper_bound: 2.0

# --- Output settings ---
output:
  plot_size:
    width: 1400
    height: 1200
  camera_angle:
    azimuth: 30
    elevation: 30

# --- Single-option mispricing detection (legacy) ---
arb_probe:
  price_abs_threshold: 50.0    # $
  price_rel_threshold: 0.02    # 2%
  vol_pp_threshold: 0.50       # vol percentage points

# ==========================================
# Butterfly Spread Analysis Configuration
# ==========================================

butterfly:
  # Minimum price error to flag butterfly as mispriced
  price_abs_threshold: 20.0    # currency units ($)
  price_rel_threshold: 0.05    # 5% of butterfly price
  
  # Minimum gain threshold to consider position "reverted"
  # (as fraction of position cost, e.g., 0.10 = 10% gain required)
  min_gain_threshold: 0.10
  
  # Reversion tracking settings
  tracking_horizon: "2h"        # How long to track (hardcoded to 2h in current implementation)
  tracking_interval: "15m"      # Check price every 15 minutes